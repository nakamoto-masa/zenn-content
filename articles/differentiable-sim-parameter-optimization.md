---
title: "ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´ã€æ•°å€‹ãŒé™ç•Œã ã¨æ€ã£ã¦ã„ã¾ã›ã‚“ã‹"
emoji: "ğŸ“"
type: "tech"
topics: ["jax", "simulation", "è‡ªå‹•å¾®åˆ†", "æ•°å€¤è¨ˆç®—", "æœ€é©åŒ–"]
published: true
---

ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¨å®Ÿæ©Ÿã®æŒ™å‹•ãŒåˆã‚ãªã„ã€‚æ‘©æ“¦ä¿‚æ•°ã‚’å¤‰ãˆã¦ã¿ã‚‹ã€‚æ¸›è¡°ã‚’èª¿æ•´ã™ã‚‹ã€‚è³ªé‡ã‚’ã„ã˜ã‚‹ã€‚æ•°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ‰‹ã§å›ã—ã¦ã€æ³¢å½¢ã‚’è¦‹æ¯”ã¹ã¦ã€ã€Œã¾ã‚ã“ã‚“ãªã‚‚ã®ã‹ã€ã§å¦¥å”ã™ã‚‹ã€‚

ã“ã®ä½œæ¥­ã«å¿ƒå½“ãŸã‚ŠãŒã‚ã‚‹äººã¯å¤šã„ã¨æ€ã„ã¾ã™ã€‚ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹æœ€é©åŒ–ï¼ˆéºä¼çš„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã€ãƒ™ã‚¤ã‚ºæœ€é©åŒ–ãªã©ï¼‰ã‚’ä½¿ã£ã¦ã‚‚ã€ç¾å®Ÿçš„ã«å›ã›ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ã›ã„ãœã„æ•°å€‹ã€œåæ•°å€‹ã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•°ãŒå¢—ãˆã‚‹ã¨æ¢ç´¢ç©ºé–“ãŒçˆ†ç™ºã—ã¦ã€è¨ˆç®—ãŒçµ‚ã‚ã‚‰ãªããªã‚‹ã€‚

ã§ã‚‚å®Ÿéš›ã®ã‚·ã‚¹ãƒ†ãƒ ã«ã¯ã€èª¿æ•´ã—ãŸã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒä½•åã€ä½•ç™¾ã¨ã‚ã‚‹ã€‚ãƒ­ãƒœãƒƒãƒˆãªã‚‰é–¢ç¯€ã”ã¨ã®æ‘©æ“¦ãƒ»æ¸›è¡°ãƒ»å‰›æ€§ã€å„ãƒªãƒ³ã‚¯ã®è³ªé‡ã¨æ…£æ€§ãƒ†ãƒ³ã‚½ãƒ«ã€‚æ©Ÿæ§‹ã§ã‚ã‚Œã°æ¥è§¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚„ã°ã­ç‰¹æ€§ã€‚ææ–™ãªã‚‰å¼¾æ€§ä¿‚æ•°ã‚„ç²˜æ€§ã€‚æ•°å€‹ã«çµã£ã¦èª¿æ•´ã™ã‚‹ã®ã¯ã€Œãã‚Œã—ã‹ã§ããªã„ã‹ã‚‰ã€ã§ã‚ã£ã¦ã€æœ¬å½“ã¯å…¨éƒ¨åˆã‚ã›è¾¼ã¿ãŸã„ã€‚

è‡ªå‹•å¾®åˆ†ã‚’ä½¿ãˆã°ã€ãã‚ŒãŒã§ãã¾ã™ã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæ•°ç™¾ã‚ã£ã¦ã‚‚ã€æ•°ä¸‡ã‚ã£ã¦ã‚‚ã€‚

## ã“ã®è¨˜äº‹ã®å¯¾è±¡èª­è€…

- ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´ï¼ˆã‚·ã‚¹ãƒ†ãƒ åŒå®šã€sim-to-realï¼‰ã§è‹¦åŠ´ã—ã¦ã„ã‚‹äºº
- ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹æœ€é©åŒ–ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•°ã®å£ã«ã¶ã¤ã‹ã£ã¦ã„ã‚‹äºº
- ã€Œå¾®åˆ†å¯èƒ½ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€ã¨ã„ã†è¨€è‘‰ã‚’èã„ãŸã“ã¨ã¯ã‚ã‚‹ã‘ã©ã€è‡ªåˆ†ã®ä»•äº‹ã¨ä½•ãŒé–¢ä¿‚ã‚ã‚‹ã‹ã‚ã‹ã‚‰ãªã„äºº

## ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹æœ€é©åŒ–ã®å£

å¾“æ¥ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–ã¯ã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã¨ã—ã¦æ‰±ã„ã¾ã™ã€‚

1. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨­å®šã™ã‚‹
2. ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å›ã™
3. å‡ºåŠ›ã¨å®Ÿæ¸¬ãƒ‡ãƒ¼ã‚¿ã®å·®ï¼ˆç›®çš„é–¢æ•°ï¼‰ã‚’è¨ˆç®—ã™ã‚‹
4. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å¤‰ãˆã¦1ã«æˆ»ã‚‹

éºä¼çš„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚„ãƒ™ã‚¤ã‚ºæœ€é©åŒ–ã¯ã€Œæ¬¡ã«ã©ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è©¦ã™ã‹ã€ã‚’è³¢ãé¸ã³ã¾ã™ãŒã€åŸç†çš„ã«ã¯ã“ã®ãƒ«ãƒ¼ãƒ—ã®ç¹°ã‚Šè¿”ã—ã€‚ç›®çš„é–¢æ•°ã®å€¤ã¯è¦‹ãˆã‚‹ã‘ã©ã€ã€Œå„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã©ã£ã¡ã«ã©ã‚Œã ã‘å‹•ã‹ã›ã°ç›®çš„é–¢æ•°ãŒä¸‹ãŒã‚‹ã‹ã€ã¯ã‚ã‹ã‚‰ãªã„ã€‚ã ã‹ã‚‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç©ºé–“ã‚’æ¢ç´¢ã™ã‚‹ã—ã‹ãªãã€æ¬¡å…ƒãŒå¢—ãˆã‚‹ã¨ç ´ç¶»ã™ã‚‹ã€‚

ã“ã‚ŒãŒã€Œæ•°å€‹ãŒé™ç•Œã€ã®æ­£ä½“ã§ã™ã€‚

## è‡ªå‹•å¾®åˆ†ã¯ä½•ãŒé•ã†ã®ã‹

è‡ªå‹•å¾®åˆ†ï¼ˆAutomatic Differentiation, ADï¼‰ã‚’ä½¿ã†ã¨ã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å†…éƒ¨æ§‹é€ ã‚’åˆ©ç”¨ã—ã¦**ã™ã¹ã¦ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«å¯¾ã™ã‚‹å‹¾é…ã‚’ä¸€åº¦ã«è¨ˆç®—**ã§ãã¾ã™ã€‚

$$
\nabla_\theta L = \left(\frac{\partial L}{\partial \theta_1}, \frac{\partial L}{\partial \theta_2}, \ldots, \frac{\partial L}{\partial \theta_n}\right)
$$

$L$ ã¯ç›®çš„é–¢æ•°ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å‡ºåŠ›ã¨å®Ÿæ¸¬ãƒ‡ãƒ¼ã‚¿ã®å·®ï¼‰ã€$\theta$ ã¯ç‰©ç†ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€‚ã“ã®å‹¾é…ãƒ™ã‚¯ãƒˆãƒ«ãŒã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•° $n$ ã«**ã»ã¼ä¾å­˜ã—ãªã„ã‚³ã‚¹ãƒˆ**ã§æ‰‹ã«å…¥ã‚‹ã€‚

å‹¾é…ãŒã‚ã‚Œã°ã€ã€Œæ‘©æ“¦ã‚’å°‘ã—ä¸Šã’ã¦ã€æ¸›è¡°ã‚’å°‘ã—ä¸‹ã’ã¦ã€è³ªé‡ã¯ã“ã®ã¾ã¾ã€ã¨ã„ã†å…·ä½“çš„ãªæ”¹å–„æ–¹å‘ãŒã‚ã‹ã‚‹ã€‚å±±ã®æ–œé¢ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«æ­©ãå›ã‚‹ä»£ã‚ã‚Šã«ã€ä¸€ç•ªæ€¥ãªä¸‹ã‚Šå‚ã®æ–¹å‘ãŒè¦‹ãˆã‚‹ã€‚

æ©Ÿæ¢°å­¦ç¿’ã§ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ä½•ç™¾ä¸‡ã‚‚ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‹¾é…é™ä¸‹æ³•ã§æœ€é©åŒ–ã§ãã‚‹ã®ã¯ã€ã“ã®ä»•çµ„ã¿ã®ãŠã‹ã’ã§ã™ã€‚PyTorchã‚„JAXã¨ã„ã£ãŸãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒã“ã®è‡ªå‹•å¾®åˆ†ã‚’æä¾›ã—ã¦ã„ã¦ã€åŒã˜åŸç†ãŒç‰©ç†ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã‚‚ä½¿ãˆã‚‹ã€‚

:::message
æœ‰é™å·®åˆ†æ³•ã§ã‚‚å‹¾é…ã¯æ¨å®šã§ãã¾ã™ãŒã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã”ã¨ã«ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’1å›ï¼ˆä¸­å¿ƒå·®åˆ†ãªã‚‰2å›ï¼‰ã‚„ã‚Šç›´ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒ100å€‹ã‚ã‚Œã°100å›ï¼ˆ200å›ï¼‰ã€‚è‡ªå‹•å¾®åˆ†ãªã‚‰1å›ã®é€†ä¼æ’­ã§å…¨éƒ¨ã®å‹¾é…ãŒå‡ºã¾ã™ã€‚
:::

## ã€Œå¾®åˆ†å¯èƒ½ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€ã¨ã¯

ã€Œå¾®åˆ†å¯èƒ½ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€ï¼ˆdifferentiable simulationï¼‰ã¯ã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨ˆç®—éç¨‹ãŒè‡ªå‹•å¾®åˆ†ã«å¯¾å¿œã—ã¦ã„ã¦ã€å…¥åŠ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«é–¢ã™ã‚‹å‹¾é…ã‚’è‡ªå‹•è¨ˆç®—ã§ãã‚‹ã‚‚ã®ã€‚

ä½•ãŒå¬‰ã—ã„ã®ã‹ã€ã‚·ã‚¹ãƒ†ãƒ åŒå®šã‚’ä¾‹ã«è¦‹ã¦ã¿ã¾ã™ã€‚

### å¾“æ¥ã®ã‚·ã‚¹ãƒ†ãƒ åŒå®š

```mermaid
graph LR
    Î¸[ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ Î¸] --> SIM[/"ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³<br>ï¼ˆä¸­èº«ã¯è¦‹ãˆãªã„ï¼‰"/]
    SIM --> y[å‡ºåŠ› y]
    y -. æ¯”è¼ƒ .-> L[èª¤å·®]
    y_real[å®Ÿæ¸¬ãƒ‡ãƒ¼ã‚¿ y*] -. æ¯”è¼ƒ .-> L
    L -. "æ¬¡ã«è©¦ã™ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¢ç´¢" .-> Î¸

    style SIM fill:#888,color:#fff
```

ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¸­ã§ã©ã‚“ãªè¨ˆç®—ãŒè¡Œã‚ã‚ŒãŸã‹ã¯é–¢ä¿‚ãªã„ã€‚å…¥åŠ›ã¨å‡ºåŠ›ã®é–¢ä¿‚ã ã‘ã‚’è¦‹ã¦ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¢ç´¢çš„ã«å¤‰ãˆã¦ã„ãã€‚

### å¾®åˆ†å¯èƒ½ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹ã‚·ã‚¹ãƒ†ãƒ åŒå®š

```mermaid
graph LR
    Î¸[ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ Î¸] --> F1[åŠ›ã®è¨ˆç®—]
    F1 --> F2[ç©åˆ†]
    F2 --> F3[æ¥è§¦åˆ¤å®š]
    F3 --> y[å‡ºåŠ› y]
    y -. å·® .-> L[æå¤± L]
    y_real[å®Ÿæ¸¬ãƒ‡ãƒ¼ã‚¿ y*] -. å·® .-> L
    L -- "å‹¾é… âˆ‚L/âˆ‚Î¸" --> F3
    F3 -- "å‹¾é…" --> F2
    F2 -- "å‹¾é…" --> F1
    F1 -- "å‹¾é…" --> Î¸

    style F1 fill:#4a9eff,color:#fff
    style F2 fill:#4a9eff,color:#fff
    style F3 fill:#4a9eff,color:#fff
```

ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å†…éƒ¨ã®å„è¨ˆç®—ã‚¹ãƒ†ãƒƒãƒ—ã‚’é€šã£ã¦ã€å‡ºåŠ›ã‹ã‚‰å…¥åŠ›ã¾ã§é€£é–å¾‹ï¼ˆchain ruleï¼‰ã§å‹¾é…ã‚’ãŸã©ã‚Œã‚‹ã€‚ä¸­èº«ãŒè¦‹ãˆã‚‹ã‹ã‚‰ã€ã™ã¹ã¦ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ã€Œã©ã£ã¡ã«ã©ã‚Œã ã‘å‹•ã‹ã›ã°ã„ã„ã‹ã€ãŒã‚ã‹ã‚‹ã€‚

ã“ã®é•ã„ã¯ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå°‘ãªã„ã†ã¡ã¯ç›®ç«‹ã¡ã¾ã›ã‚“ã€‚5å€‹ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãªã‚‰ã€éºä¼çš„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã‚‚ååˆ†åæŸã™ã‚‹ã€‚ã§ã‚‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒ50å€‹ã€500å€‹ã«ãªã‚‹ã¨ã€æ¢ç´¢ãƒ™ãƒ¼ã‚¹ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ç¾å®Ÿçš„ãªè¨ˆç®—æ™‚é–“ã§ã¯åæŸã—ãªããªã‚Šã¾ã™ã€‚å‹¾é…ãƒ™ãƒ¼ã‚¹ãªã‚‰ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•°ã«ã»ã¼é–¢ä¿‚ãªãæ›´æ–°æ–¹å‘ãŒæ±ºã¾ã‚‹ã€‚

## MuJoCo MJXã®è©±â€”â€”ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«æ›¸ã‹ã‚Œã¦ã„ãªã„äº‹å®Ÿ

å¾®åˆ†å¯èƒ½ãªç‰©ç†ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å…·ä½“ä¾‹ã¨ã—ã¦ã€MuJoCo MJXãŒã‚ã‚Šã¾ã™ã€‚MuJoCoã®ç‰©ç†æ¼”ç®—ã‚’JAXã§å†å®Ÿè£…ã—ãŸã‚‚ã®ã§ã€GPU/TPUä¸Šã§ã®ãƒãƒƒãƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾å¿œã€‚

ã“ã“ã§é¢ç™½ã„è©±ãŒã‚ã‚Šã¾ã™ã€‚**MJXã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯ã€Œå¾®åˆ†å¯èƒ½ã€ã¨ã»ã¼æ›¸ã‹ã‚Œã¦ã„ãªã„ã€‚**

[MJXã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://mujoco.readthedocs.io/en/stable/mjx.html)ã‚’èª­ã‚€ã¨ã€æ›¸ã‹ã‚Œã¦ã„ã‚‹ã®ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã€`jit`ã¨`vmap`ã«ã‚ˆã‚‹ãƒãƒƒãƒå®Ÿè¡Œã€ãƒã‚¤ãƒ†ã‚£ãƒ–MuJoCoã¨ã®æ©Ÿèƒ½å·®åˆ†ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã®è©±ã€‚`jax.grad`ï¼ˆè‡ªå‹•å¾®åˆ†ï¼‰ã¸ã®è¨€åŠã¯ãªã„ã€‚

ã€ŒMJXã¯è‡ªå‹•å¾®åˆ†ã«å¯¾å¿œã—ã¦ã„ã‚‹ã€ã¨æ˜ç¤ºçš„ã«æ›¸ã‹ã‚Œã¦ã„ã‚‹å ´æ‰€ã¯ã€MJXè‡ªèº«ã®ãƒšãƒ¼ã‚¸ã§ã¯ãªã[MJWarpã®ãƒšãƒ¼ã‚¸](https://mujoco.readthedocs.io/en/latest/mjwarp/)ã®æ¯”è¼ƒæ–‡è„ˆã«ã‚ã‚‹ä¸€æ–‡ã ã‘ã§ã™ã€‚

> The dynamics API in MJX is automatically differentiable via JAX.

ãªãœã‹ã€‚MJXã¯JAXã§æ›¸ã‹ã‚Œã¦ã„ã‚‹ã®ã§ã€JAXã®`jax.grad`ã§è‡ªå‹•çš„ã«å¾®åˆ†ã§ãã‚‹ã€‚JAXã®ä¸–ç•Œã§ã¯ã€ŒJAXã§æ›¸ã„ãŸé–¢æ•°ã¯å¾®åˆ†å¯èƒ½ã€ã¯å½“ãŸã‚Šå‰ã®å‰æãªã®ã§ã€ã‚ã–ã‚ã–æ›¸ãå¿…è¦ãŒãªã„â€”â€”ã¨ã„ã†ã®ãŒé–‹ç™ºå´ã®æ„Ÿè¦šã®ã‚ˆã†ã§ã™ã€‚

ã§ã‚‚JAXã«é¦´æŸ“ã¿ã®ãªã„äººã«ã¨ã£ã¦ã¯ã€å½“ãŸã‚Šå‰ã§ã¯ãªã„ã€‚MuJoCoã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚€äººã®å¤šãã¯ãƒ­ãƒœãƒ†ã‚£ã‚¯ã‚¹ã‚„ç”Ÿä½“åŠ›å­¦ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã€ã€ŒJAXã§æ›¸ã‹ã‚Œã¦ã„ã‚‹ï¼å¾®åˆ†å¯èƒ½ã€ã¨ã„ã†æš—é»™ã®å‰æã‚’å…±æœ‰ã—ã¦ã„ãªã„ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ§‹é€ ãŒã€æœ€ã‚‚ã“ã®æ©Ÿèƒ½ã‚’å¿…è¦ã¨ã—ã¦ã„ã‚‹äººã«å±Šãã«ãã„å½¢ã«ãªã£ã¦ã„ã¾ã™ã€‚

### ãƒã‚¤ãƒ†ã‚£ãƒ–MuJoCoã¨MJXã®å¾®åˆ†æ©Ÿèƒ½ã®é•ã„

|  | ãƒã‚¤ãƒ†ã‚£ãƒ– MuJoCo (C) | MJX (JAX) |
|---|---|---|
| å¾®åˆ†ã®æ–¹å¼ | æœ‰é™å·®åˆ† | è‡ªå‹•å¾®åˆ† |
| æä¾›ã•ã‚Œã‚‹é–¢æ•° | `mjd_transitionFD`ï¼ˆçŠ¶æ…‹é·ç§»ï¼‰ã€`mjd_inverseFD`ï¼ˆé€†å‹•åŠ›å­¦ï¼‰ | `jax.grad`ã§ä»»æ„ã®é–¢æ•°ã‚’å¾®åˆ†å¯èƒ½ |
| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•°ã®ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•°ã«æ¯”ä¾‹ã—ã¦ã‚³ã‚¹ãƒˆå¢— | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•°ã«ã»ã¼ä¾å­˜ã—ãªã„ |
| å…¸å‹çš„ãªç”¨é€” | LQRåˆ¶å¾¡å™¨ã®A/Bè¡Œåˆ—è¨ˆç®— | å‹¾é…ãƒ™ãƒ¼ã‚¹ã®è»Œé“æœ€é©åŒ–ã€ã‚·ã‚¹ãƒ†ãƒ åŒå®šã€åˆ¶å¾¡å™¨ã®å­¦ç¿’ |

ãƒã‚¤ãƒ†ã‚£ãƒ–MuJoCoã«ã‚‚`mjd_transitionFD`ã¨ã„ã†å¾®åˆ†é–¢æ•°ãŒã‚ã‚Šã¾ã™ãŒã€ã“ã‚Œã¯æœ‰é™å·®åˆ†ã§ã™ã€‚çŠ¶æ…‹é·ç§»ã®ãƒ¤ã‚³ãƒ“ã‚¢ãƒ³ã‚’åŠ¹ç‡çš„ã«è¨ˆç®—ã™ã‚‹é–¢æ•°ã§ã€LQRåˆ¶å¾¡å™¨ã®è¨­è¨ˆã«ã¯ååˆ†ã€‚ãŸã ã—ã€Œã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã‚’é€šã—ã¦ä»»æ„ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‹¾é…ã‚’å–ã‚‹ã€ã¨ã„ã†ç”¨é€”ã«ã¯å‘ã„ã¦ã„ã¾ã›ã‚“ã€‚

## ä½•ãŒå¿…è¦ã‹â€”â€”JAXã®å£

ã“ã“ã¾ã§èª­ã‚“ã§ã€Œä½¿ã£ã¦ã¿ãŸã„ã€ã¨æ€ã£ãŸæ–¹ã«ã€æ­£ç›´ãªè©±ã‚’ã—ã¾ã™ã€‚

MJXã§è‡ªå‹•å¾®åˆ†ã‚’ä½¿ã†ã«ã¯ã€JAXã®æµå„€ã§ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```python
import jax
import mujoco
from mujoco import mjx

# MuJoCoãƒ¢ãƒ‡ãƒ«ã‚’MJXã«å¤‰æ›
model = mujoco.MjModel.from_xml_path('robot.xml')
mjx_model = mjx.put_model(model)

# ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹é–¢æ•°
def simulate(params, mjx_model, mjx_data):
    # paramsã§ãƒ¢ãƒ‡ãƒ«ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ›´æ–°
    # ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ•°ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œ
    # å‡ºåŠ›ã¨å®Ÿæ¸¬ãƒ‡ãƒ¼ã‚¿ã®å·®ï¼ˆæå¤±ï¼‰ã‚’è¿”ã™
    ...
    return loss

# å‹¾é…ã‚’è¨ˆç®—
grad_fn = jax.grad(simulate)
grads = grad_fn(params, mjx_model, mjx_data)
```

æ¦‚å¿µã¨ã—ã¦ã¯ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ãŒã€å®Ÿéš›ã«å‹•ãã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã«ã¯JAXç‰¹æœ‰ã®åˆ¶ç´„ï¼ˆç´”ç²‹é–¢æ•°ã€é™çš„ãªé…åˆ—ã‚µã‚¤ã‚ºã€pytreeã®æ‰±ã„ç­‰ï¼‰ã‚’ç†è§£ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚MATLABã‚„Simulinkã§ã‚·ã‚¹ãƒ†ãƒ åŒå®šã‚’ã‚„ã£ã¦ããŸäººã«ã¨ã£ã¦ã¯ã€ã‹ãªã‚Šé ã„ä¸–ç•Œã§ã—ã‚‡ã†ã€‚

ãŸã ã€JAXã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ãƒ¢ãƒ‡ãƒ«è‡ªä½“ã¯æ•°æ—¥ã€œæ•°é€±é–“ã§ç¿’å¾—ã§ãã‚‹ãƒ¬ãƒ™ãƒ«ã§ã€æ ¹æœ¬çš„ã«é›£ã—ã„ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒãƒ¼ãƒ‰ãƒ«ãŒé«˜ãè¦‹ãˆã‚‹ã®ã¯ã€ŒçŸ¥ã‚‰ãªã„ã‹ã‚‰ã€ã§ã‚ã£ã¦ã€Œé›£ã—ã„ã‹ã‚‰ã€ã§ã¯ãªã„ã€ã¨ã„ã†å´é¢ãŒå¤§ãã„ã€‚[JAXã®å…¬å¼ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«](https://docs.jax.dev/en/latest/tutorials.html)ã¯ä¸å¯§ã«æ›¸ã‹ã‚Œã¦ã„ã¦ã€NumPyãŒä½¿ãˆã‚‹äººãªã‚‰å…¥ã‚Šã‚„ã™ã„ã¯ãšã€‚

## ã“ã®å…ˆã®å…¥ã‚Šå£

MuJoCoã«ã¯[MJXã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«](https://mujoco.readthedocs.io/en/stable/mjx.html#tutorial-and-colab-notebooks)ãŒ2ã¤å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚ã©ã¡ã‚‰ã‚‚ãƒ­ãƒœãƒƒãƒˆã®æ­©è¡Œåˆ¶å¾¡ã‚’å­¦ç¿’ã™ã‚‹ä¾‹ã§ã€1ã¤ã¯å¼·åŒ–å­¦ç¿’ï¼ˆPPOï¼‰ã€ã‚‚ã†1ã¤ã¯ã€Œdifferentiable physics tutorialã€ã¨é¡Œã•ã‚ŒãŸã‚‚ã®ã€‚å¾Œè€…ã¯`jax.grad`ã§ç‰©ç†ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é€šã—ã¦å‹¾é…ã‚’å–ã‚Šã¾ã™ãŒã€æœ€é©åŒ–ã®å¯¾è±¡ã¯åˆ¶å¾¡å™¨ï¼ˆãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®é‡ã¿ï¼‰ã§ã‚ã£ã¦ã€ç‰©ç†ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆæ‘©æ“¦ã‚„è³ªé‡ï¼‰ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã€Œdifferentiableã€ã¨æ›¸ã„ã¦ã‚ã£ã¦ã‚‚ã‚·ã‚¹ãƒ†ãƒ åŒå®šã®å‚è€ƒã«ã¯ãªã‚‰ãªã„ã€ã¨ã„ã†ç‚¹ã¯æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚

å¾®åˆ†å¯èƒ½ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯MJXã ã‘ã®ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚NVIDIA Warpã€Taichiï¼ˆDiffTaichiï¼‰ã€Braxãªã©ã€è¤‡æ•°ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒå­˜åœ¨ã—ã¾ã™ã€‚æ‰±ã†ç‰©ç†ï¼ˆå‰›ä½“ã€æµä½“ã€å¼¾æ€§ä½“ï¼‰ã‚„ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆJAXã€CUDAã€ç‹¬è‡ªDSLï¼‰ãŒç•°ãªã‚‹ã®ã§ã€ç”¨é€”ã«å¿œã˜ã¦é¸ã¶ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

| ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | ä¸»ãªå¯¾è±¡ |
|---|---|---|
| MuJoCo MJX | JAX | å‰›ä½“ãƒ»æ¥è§¦ãƒ»ã‚¢ã‚¯ãƒãƒ¥ã‚¨ãƒ¼ã‚¿ |
| NVIDIA Warp | CUDA | å‰›ä½“ãƒ»æµä½“ãƒ»å¸ƒãƒ»ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ« |
| Taichi / DiffTaichi | ç‹¬è‡ª | å¼¾æ€§ä½“ãƒ»æµä½“ï¼ˆMPMç­‰ï¼‰ |
| Brax | JAXï¼ˆMJXå«ã‚€è¤‡æ•°ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼‰ | å¼·åŒ–å­¦ç¿’ç’°å¢ƒ |

ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´ã‚’ã€Œæ•°å€‹ã‚’æ‰‹ã§å›ã™è·äººèŠ¸ã€ã‹ã‚‰ã€Œå…¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‹¾é…ã§æœ€é©åŒ–ã™ã‚‹ã€ã«å¤‰ãˆã‚‰ã‚Œã‚‹ã€‚æŠ€è¡“ã¨ã—ã¦ã¯ã™ã§ã«ä½¿ãˆã‚‹æ®µéšã«ã‚ã‚‹ã®ã«ã€ãã‚Œã‚’å¿…è¦ã¨ã—ã¦ã„ã‚‹äººã®ã¨ã“ã‚ã«ã¾ã ååˆ†å±Šã„ã¦ã„ãªã„â€”â€”ã¨ã„ã†ã®ãŒã€MJXã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚“ã§æ„Ÿã˜ãŸã“ã¨ã§ã—ãŸã€‚

## å‚è€ƒæ–‡çŒ®

- [MuJoCo MJX ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://mujoco.readthedocs.io/en/stable/mjx.html)
- [MuJoCo Computation > Derivatives](https://mujoco.readthedocs.io/en/stable/computation/index.html) â€” ãƒã‚¤ãƒ†ã‚£ãƒ–MuJoCoã®å¾®åˆ†æ©Ÿèƒ½
- [MuJoCo MJWarp](https://mujoco.readthedocs.io/en/latest/mjwarp/) â€” MJXã®è‡ªå‹•å¾®åˆ†ã«é–¢ã™ã‚‹å”¯ä¸€ã®æ˜ç¤ºçš„ãªè¨˜è¿°ãŒã‚ã‚‹
- [JAX å…¬å¼ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«](https://docs.jax.dev/en/latest/tutorials.html)
- [The Elements of Differentiable Programming](https://arxiv.org/abs/2403.14606)ï¼ˆ[æ—¥æœ¬èªè§£èª¬](https://www.alphaxiv.org/ja/overview/2403.14606)ï¼‰â€” å¾®åˆ†å¯èƒ½ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®åŒ…æ‹¬çš„æ•™ç§‘æ›¸
